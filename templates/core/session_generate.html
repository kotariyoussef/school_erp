{% extends 'core/base.html' %}
{% block title %}Generate Sessions - School ERP{% endblock %}
{% block content %}
<div class="container">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card">
        <div class="card-header bg-primary text-white">
          <h4 class="mb-0"><i class="bi bi-gear"></i> Générer les sessions</h4>
        </div>
        <div class="card-body">
          {% if errors %}
            <div class="alert alert-danger">
              {% for error in errors %}
                <div>{{ error }}</div>
              {% endfor %}
            </div>
          {% endif %}

          {% if summary %}
            <div class="alert alert-info">
              <h5>Résultat de la génération</h5>
              <ul class="mb-0">
                <li><strong style="color: green;">Créées:</strong> {{ summary.created }} sessions</li>
                <li><strong style="color: orange;">Mises à jour:</strong> {{ summary.updated }} sessions</li>
                <li><strong style="color: red;">Supprimées:</strong> {{ summary.deleted }} sessions</li>
                <li><strong>Ignorées:</strong> {{ summary.skipped }} sessions</li>
              </ul>
            </div>

            {% if summary.errors %}
              <div class="alert alert-warning">
                <h6>Erreurs rencontrées:</h6>
                <ul class="small mb-0">
                  {% for err in summary.errors %}
                    <li>{{ err }}</li>
                  {% endfor %}
                </ul>
              </div>
            {% endif %}

            <div class="mt-4">
              <a href="{% url 'core:sessions_schedule' %}" class="btn btn-primary">
                <i class="bi bi-calendar3"></i> Voir le planning
              </a>
            </div>
          {% else %}
            <form method="post" class="mt-3">
              {% csrf_token %}
              <div class="mb-3">
                <label for="weeks" class="form-label">Nombre de semaines à générer</label>
                <input type="number" id="weeks" name="weeks" class="form-control" value="4" min="1" max="26">
                <small class="text-muted">À partir d'aujourd'hui</small>
              </div>

              <div class="form-check mb-3">
                <input class="form-check-input" type="checkbox" id="force" name="force">
                <label class="form-check-label" for="force">
                  <strong>Forcer la mise à jour</strong> des sessions existantes si l'horaire/salle a changé
                </label>
              </div>

              <div class="alert alert-info">
                <h6>ℹ️ Qu'est-ce que cela fait ?</h6>
                <ul class="small mb-0">
                  <li>Crée les sessions manquantes selon les horaires des groupes de cours</li>
                  <li>Respecte les exceptions de session (annulations, changements d'horaire/salle)</li>
                  <li>Avec "Forcer": met à jour les sessions existantes si les paramètres ont changé</li>
                </ul>
              </div>

              <div class="d-flex gap-2">
                <button class="btn btn-success btn-lg" type="submit">
                  <i class="bi bi-play-fill"></i> Générer
                </button>
                <a href="{% url 'core:sessions_schedule' %}" class="btn btn-secondary">Annuler</a>
              </div>
            </form>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}
